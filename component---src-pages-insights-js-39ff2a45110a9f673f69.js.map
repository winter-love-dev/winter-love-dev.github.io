{"version":3,"file":"component---src-pages-insights-js-39ff2a45110a9f673f69.js","mappings":"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","sources":["webpack://winter-love.dev/./src/pages/insights.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useMemo } from 'react';\nimport { graphql, navigate } from 'gatsby';\nimport { getImage } from 'gatsby-plugin-image';\nimport { Chip, IconButton } from '@mui/material';\nimport CloseIcon from '@mui/icons-material/Close';\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\nimport Layout from '../layout';\nimport Seo from '../components/seo';\nimport InsightFeedCard from '../components/insight-feed-card';\nimport './insights.scss';\n\n// ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ ì»´í¬ë„ŒíŠ¸\nconst EmptyMessage = () => {\n  return (\n    <div className=\"insights-empty-message\">\n      You've seen all insights ğŸ¤—\n    </div>\n  );\n};\n\nconst InsightsPage = ({ data, location }) => {\n  const allInsights = useMemo(() => data.allMarkdownRemark.edges.map(({ node }) => node), [data.allMarkdownRemark.edges]);\n\n  // Author ë©”íƒ€ë°ì´í„° (í•œ ë²ˆë§Œ ì¶”ì¶œ)\n  const profileImage = getImage(data.profileImage);\n  const { nickname, bio } = data.site.siteMetadata.author;\n  const authorData = { profileImage, nickname, role: bio.role };\n  const PAGE_SIZE = 5;\n  const INITIAL_LOAD = 5; // ì´ˆê¸° ë¡œë“œëŠ” 5ê°œ (í™”ë©´ì„ í™•ì‹¤íˆ ì±„ìš°ê¸° ìœ„í•´)\n\n  // URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ íƒœê·¸ ì½ê¸°\n  const [selectedTag, setSelectedTag] = useState(() => {\n    if (typeof window !== 'undefined') {\n      const params = new URLSearchParams(location.search);\n      return params.get('tag') || null;\n    }\n    return null;\n  });\n\n  // íƒœê·¸ë¡œ í•„í„°ë§ëœ insights\n  const filteredInsights = useMemo(() => {\n    if (!selectedTag) return allInsights;\n    return allInsights.filter(insight => {\n      const tags = insight.frontmatter.insightTags || [];\n      return tags.includes(selectedTag);\n    });\n  }, [allInsights, selectedTag]);\n\n  // ë¬´í•œ ìŠ¤í¬ë¡¤ ìƒíƒœ\n  const [displayedInsights, setDisplayedInsights] = useState([]);\n  const [hasMore, setHasMore] = useState(true);\n  const [currentPage, setCurrentPage] = useState(1);\n\n  // Intersection Observer ref\n  const observerTarget = useRef(null);\n  const filteredInsightsRef = useRef(filteredInsights);\n  const pageSizeRef = useRef(PAGE_SIZE);\n  const hasMoreRef = useRef(hasMore);\n  const currentPageRef = useRef(currentPage);\n\n  // refs ì—…ë°ì´íŠ¸\n  useEffect(() => {\n    filteredInsightsRef.current = filteredInsights;\n    hasMoreRef.current = hasMore;\n    currentPageRef.current = currentPage;\n  }, [filteredInsights, hasMore, currentPage]);\n\n  // íƒœê·¸ ë³€ê²½ì‹œ ë˜ëŠ” ì´ˆê¸° ë¡œë“œ\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const savedScroll = sessionStorage.getItem('insights-scroll');\n    const savedLoadedCount = sessionStorage.getItem('insights-loaded-count');\n    const savedTag = sessionStorage.getItem('insights-tag');\n\n    // íƒœê·¸ê°€ ë³€ê²½ë˜ì—ˆê±°ë‚˜ ì²˜ìŒ ë¡œë“œì¸ ê²½ìš°\n    if (savedLoadedCount && savedTag === selectedTag) {\n      // ì €ì¥ëœ ê°œìˆ˜ë§Œí¼ ë¯¸ë¦¬ ë¡œë“œ (ê°™ì€ íƒœê·¸ì¸ ê²½ìš°ì—ë§Œ)\n      const loadedCount = parseInt(savedLoadedCount, 10);\n      const initialDisplayed = filteredInsights.slice(0, loadedCount);\n      setDisplayedInsights(initialDisplayed);\n      setCurrentPage(Math.ceil(loadedCount / PAGE_SIZE));\n      setHasMore(loadedCount < filteredInsights.length);\n\n      // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›\n      if (savedScroll) {\n        setTimeout(() => {\n          window.scrollTo(0, parseInt(savedScroll, 10));\n        }, 100);\n      }\n\n      // sessionStorage ì´ˆê¸°í™”\n      sessionStorage.removeItem('insights-scroll');\n      sessionStorage.removeItem('insights-loaded-count');\n      sessionStorage.removeItem('insights-tag');\n    } else {\n      // ì´ˆê¸° ë¡œë“œ ë˜ëŠ” íƒœê·¸ ë³€ê²½ (ì²˜ìŒ 5ê°œ - í™”ë©´ì„ ì±„ìš°ê¸° ìœ„í•´)\n      const initialDisplayed = filteredInsights.slice(0, INITIAL_LOAD);\n      setDisplayedInsights(initialDisplayed);\n      setCurrentPage(Math.ceil(INITIAL_LOAD / PAGE_SIZE));\n      setHasMore(filteredInsights.length > INITIAL_LOAD);\n\n      // íƒœê·¸ ë³€ê²½ì‹œ ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ\n      if (savedTag !== selectedTag) {\n        window.scrollTo(0, 0);\n      }\n    }\n  }, [filteredInsights, selectedTag]);\n\n  // Intersection Observer ì„¤ì • - ë”± í•œ ë²ˆë§Œ ìƒì„±\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting && hasMoreRef.current) {\n          console.log('Intersection Observer triggered - loading more...');\n\n          // loadMore ë¡œì§ (ëª¨ë“  ê°’ì„ refì—ì„œ ê°€ì ¸ì˜´)\n          const nextPage = currentPageRef.current + 1;\n          const startIndex = 0;\n          const endIndex = nextPage * pageSizeRef.current;\n          const newDisplayed = filteredInsightsRef.current.slice(startIndex, endIndex);\n\n          setDisplayedInsights(newDisplayed);\n          setCurrentPage(nextPage);\n          setHasMore(endIndex < filteredInsightsRef.current.length);\n        }\n      },\n      {\n        threshold: 0.1,\n        rootMargin: '200px',\n      }\n    );\n\n    const currentTarget = observerTarget.current;\n    if (currentTarget) {\n      console.log('Observer attached to target');\n      observer.observe(currentTarget);\n    }\n\n    return () => {\n      if (currentTarget) {\n        observer.unobserve(currentTarget);\n      }\n    };\n  }, []); // ë¹ˆ ë°°ì—´ - ë”± í•œ ë²ˆë§Œ ì‹¤í–‰!\n\n  // íƒœê·¸ í•„í„° í•¸ë“¤ëŸ¬\n  const handleTagClick = (tag) => {\n    if (typeof window !== 'undefined') {\n      sessionStorage.setItem('insights-tag', tag);\n    }\n    setSelectedTag(tag);\n    navigate(`/insights?tag=${encodeURIComponent(tag)}`);\n  };\n\n  const handleClearFilter = () => {\n    if (typeof window !== 'undefined') {\n      sessionStorage.removeItem('insights-tag');\n    }\n    setSelectedTag(null);\n    navigate('/insights');\n  };\n\n  // ë¹ˆ ìƒíƒœ ì²˜ë¦¬\n  if (allInsights.length === 0) {\n    return (\n      <Layout pageType=\"insight\">\n        <Seo title=\"Insights | Winter's archive\" />\n        <EmptyMessage />\n      </Layout>\n    );\n  }\n\n  return (\n    <Layout pageType=\"insight\">\n      <Seo title=\"Insights | Winter's archive\" />\n\n      <div className=\"insights-container\">\n        {/* íƒœê·¸ í•„í„° UI */}\n        {selectedTag && (\n          <div className=\"insights-filter-bar\">\n            <button\n              onClick={handleClearFilter}\n              className=\"insights-read-all-button\"\n            >\n              <ArrowBackIcon style={{ fontSize: '18px' }} />\n              Read all insights\n            </button>\n            <Chip\n              label={`#${selectedTag}`}\n              className=\"insights-filter-tag\"\n            />\n            <span className=\"insights-filter-count\">\n              {filteredInsights.length} {filteredInsights.length === 1 ? 'insight' : 'insights'}\n            </span>\n          </div>\n        )}\n        {displayedInsights.map((insight, index) => (\n          <InsightFeedCard\n            key={insight.id}\n            insight={insight}\n            authorData={authorData}\n            isDetailPage={false}\n            loadedCount={displayedInsights.length}\n            onTagClick={handleTagClick}\n          />\n        ))}\n\n        {/* Intersection Observer íƒ€ê²Ÿ */}\n        {hasMore && (\n          <div ref={observerTarget} style={{ height: '20px' }} />\n        )}\n\n        {/* ë” ì´ìƒ ê¸€ì´ ì—†ì„ ë•Œ */}\n        {!hasMore && displayedInsights.length > 0 && (\n          <EmptyMessage />\n        )}\n      </div>\n    </Layout>\n  );\n};\n\nexport const query = graphql`\n  query InsightsListQuery {\n    allMarkdownRemark(\n      filter: {\n        frontmatter: { insightPrivate: { ne: true } }\n        fileAbsolutePath: { regex: \"/insights/\" }\n      }\n      sort: { order: DESC, fields: [frontmatter___insightDate] }\n    ) {\n      edges {\n        node {\n          id\n          html\n          fields {\n            isTruncated\n            truncatedHtml\n          }\n          frontmatter {\n            insightPostId\n            insightTitle\n            insightDate\n            insightTags\n            insightPrivate\n          }\n        }\n      }\n    }\n    profileImage: file(relativePath: { eq: \"profile.jpeg\" }) {\n      childImageSharp {\n        gatsbyImageData(width: 48, height: 48, layout: FIXED)\n      }\n    }\n    site {\n      siteMetadata {\n        author {\n          nickname\n          bio {\n            role\n          }\n        }\n      }\n    }\n  }\n`;\n\nexport default InsightsPage;\n"],"names":["EmptyMessage","React","className","_ref","data","location","allInsights","useMemo","allMarkdownRemark","edges","map","_ref2","node","profileImage","getImage","nickname","bio","site","siteMetadata","author","authorData","role","selectedTag","setSelectedTag","useState","window","URLSearchParams","search","get","filteredInsights","filter","insight","frontmatter","insightTags","includes","displayedInsights","setDisplayedInsights","hasMore","setHasMore","currentPage","setCurrentPage","observerTarget","useRef","filteredInsightsRef","pageSizeRef","hasMoreRef","currentPageRef","useEffect","current","savedScroll","sessionStorage","getItem","savedLoadedCount","savedTag","loadedCount","parseInt","initialDisplayed","slice","Math","ceil","length","setTimeout","scrollTo","removeItem","INITIAL_LOAD","observer","IntersectionObserver","entries","isIntersecting","console","log","nextPage","startIndex","endIndex","newDisplayed","threshold","rootMargin","currentTarget","observe","unobserve","handleTagClick","tag","setItem","navigate","encodeURIComponent","Layout","pageType","Seo","title","onClick","handleClearFilter","ArrowBackIcon","style","fontSize","Chip","label","index","InsightFeedCard","key","id","isDetailPage","onTagClick","ref","height"],"sourceRoot":""}