{"componentChunkName":"component---src-templates-content-template-js","path":"/coroutine-deep-dive/2-coroutine-builder-context-job-and-wait-children/","result":{"data":{"cur":{"id":"de5557fe-3243-5d29-8bd9-e0f4eaa98089","html":"<blockquote>\n<p>러프하게 초안 정리 상태</p>\n</blockquote>\n<h1 id=\"코루틴-빌더\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4-%EB%B9%8C%EB%8D%94\" aria-label=\"코루틴 빌더 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴 빌더</h1>\n<p>중단 함수는 컨티뉴에이션 객체를 다른 중단 함수로 전달해야 한다.\n(4장에서 다뤘는데, 중단 함수들의 콜스택과 연결되는 개념이다)</p>\n<p>그래서 일반 함수가 중단 함수를 호출 할수는 없지만\n중단 함수는 일반 함수를 실행할 수 있다.</p>\n<p>우리는 지금까지\n중단 함수는 코루틴을 실행할 수 있으며\n코루틴은 함수를 일시중단 할 수 있다고 배웠다.</p>\n<p>그렇다면 중단 함수는 처음에 어떻게 실행 되는가?\n이것을 시작하는 지점이 코루틴 빌더다.</p>\n<p>계층으로 표현해본다면 이런 느낌?</p>\n<ul>\n<li>코루틴 빌더\n<ul>\n<li>중단 함수 or 코루틴</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"launch-빌더\" style=\"position:relative;\"><a href=\"#launch-%EB%B9%8C%EB%8D%94\" aria-label=\"launch 빌더 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>launch 빌더</h2>\n<p>새로운 일시중단 가능한 분기를 생성한다.\nlaunch 는 몇 번이든 호출하여 새로운 분기를 만들 수 있다.</p>\n<h2 id=\"runblocking-빌더\" style=\"position:relative;\"><a href=\"#runblocking-%EB%B9%8C%EB%8D%94\" aria-label=\"runblocking 빌더 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>runBlocking 빌더</h2>\n<p>이 빌더가 실행된 스레드가 중단된다.</p>\n<h2 id=\"async-빌더\" style=\"position:relative;\"><a href=\"#async-%EB%B9%8C%EB%8D%94\" aria-label=\"async 빌더 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>async 빌더</h2>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">async <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 비동기 태스크</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>비동기 태스크를 async 블록으로 감싸면 비동기 태스크가 실행되며 Deferred 타입을 반환한다.\ndeferred 객체의 await() 을 호출하면 결과 값을 반환 받을수 있다.\nawait() 를 특정 시점에서 병렬로 호출하는 응용이 가능하다.</p>\n<h2 id=\"coroutinescope-사용하기\" style=\"position:relative;\"><a href=\"#coroutinescope-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"coroutinescope 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>coroutineScope 사용하기</h2>\n<h1 id=\"코루틴-컨텍스트\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8\" aria-label=\"코루틴 컨텍스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴 컨텍스트</h1>\n<h2 id=\"coroutinecontext-인터페이스\" style=\"position:relative;\"><a href=\"#coroutinecontext-%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4\" aria-label=\"coroutinecontext 인터페이스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CoroutineContext 인터페이스</h2>\n<p>Job, CoroutineName, CoroutineDispatcher 와 같은\n원소나 원소의 집합을 나타내는 인터페이스다.</p>\n<h2 id=\"컨텍스트-더하기\" style=\"position:relative;\"><a href=\"#%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8-%EB%8D%94%ED%95%98%EA%B8%B0\" aria-label=\"컨텍스트 더하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컨텍스트 더하기</h2>\n<p>val ctx1 = CoroutineName(“one”)\nval ctx2 = CoroutineName(“two”)</p>\n<p>ctx1 + ctx2</p>\n<p>덧셈식으로 더할 수 있으며\n새로운 원소 ctx2 가 기존 원소를 대체할 수 있다.</p>\n<h2 id=\"비어있는-코루틴-컨텍스트\" style=\"position:relative;\"><a href=\"#%EB%B9%84%EC%96%B4%EC%9E%88%EB%8A%94-%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8\" aria-label=\"비어있는 코루틴 컨텍스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>비어있는 코루틴 컨텍스트</h2>\n<p>EmptyCoroutineContext</p>\n<h2 id=\"코루틴-컨텍스트와-빌더\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EC%99%80-%EB%B9%8C%EB%8D%94\" aria-label=\"코루틴 컨텍스트와 빌더 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴 컨텍스트와 빌더</h2>\n<h1 id=\"잡과-자식-코루틴-기다리기\" style=\"position:relative;\"><a href=\"#%EC%9E%A1%EA%B3%BC-%EC%9E%90%EC%8B%9D-%EC%BD%94%EB%A3%A8%ED%8B%B4-%EA%B8%B0%EB%8B%A4%EB%A6%AC%EA%B8%B0\" aria-label=\"잡과 자식 코루틴 기다리기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>잡과 자식 코루틴 기다리기</h1>\n<p><strong>Job 이란?</strong>\nJob 은 수명을 가지고 있으며 취소 가능하다.\nJob 의 수명은 상태로 나타낸다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACkElEQVR42sVU22uSYRxebWyDHauLHBHEt9ih1YqiLupCCKp/YCPY3YL6B7ouYXTXxYJoC0YImheJMkXxgIiUJnNqU+Zhns/icYnHlOzreQeKioIR0Qc/vpff+37P7/d7nuf9Bgb+9yOXy2cQNw0Gww2TyXRNqVTeUigUCzRNn+4bBIdPkbfNZhsvFAr+arVas9vtJavVWigWi6VKpfIjEonc/5PGTgA1Gs1oNpvdKJfLmx6PZxMFtlHgdT6ff+P3++fbOiAtdwaLxeo5Bp/PH2az2dOtBf/qAeAU4gJZr66uDrZthkIhChw883q96z6f70k0Gl13uVxPg8HgikgkmkAnoyTIOp1Or2E8FsZ9ZbFYXjqdzo1EIvE8EAgwmoDHx8drqVSKPjw8rDscjl8AquMgDWC/Wq1e2t3dvUgCHF6q1WopCEG73e6fEKYej8froIeOxWKPmoB7e3uTBwcHS+huzmg03jObzcuouIguKbKv0+km9Hr9WbJGV3PIL6L4dcRdFJ0H+BXkx7paQyqVMmQy2Ugr2SqVakosFi+35E9E4XK5kz1FaRiTGJfYg6wbKhPuAHqutbBWqz2D4lRrru8OUWBcIBBQeDPA7ycIYsaI+xj9G8z9FXxbk8nkw64dCoXCmU5AUoyojKs2BW4/AmQf4n0BdwTsM9ZGiPKga4dkZCg63YcPexubw+GM8Xi8BVhkViKRXIUA5/HBIJPJHOosinMU9i+DUwqTzBKeEcNtoLlc7jH8RHxYAjeVo6Oj7xijDF4MAGmCYsQRjGYBdzSsVSA/CHyTAQ3VTCaz0gQE2G3EDoDe4tK/gx+3cGs+IMcinTbOQZQh5F4AYAfCbOHcNtbvccvY4XD4zj/5Yf4GIDb9dRulM7oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"\"\n        src=\"/static/481286ca0c2d6eb302ec320e3d578fa6/37523/0.png\"\n        srcset=\"/static/481286ca0c2d6eb302ec320e3d578fa6/e9ff0/0.png 180w,\n/static/481286ca0c2d6eb302ec320e3d578fa6/f21e7/0.png 360w,\n/static/481286ca0c2d6eb302ec320e3d578fa6/37523/0.png 720w,\n/static/481286ca0c2d6eb302ec320e3d578fa6/302a4/0.png 1080w,\n/static/481286ca0c2d6eb302ec320e3d578fa6/07a9c/0.png 1440w,\n/static/481286ca0c2d6eb302ec320e3d578fa6/1321a/0.png 3086w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>잡의 상태를 확인하기 위해서는 <code class=\"language-text\">isActive</code>, <code class=\"language-text\">isCompleted</code>, <code class=\"language-text\">isCancelled</code> 프로퍼티를 사용하면 된다.</p>\n<table>\n<thead>\n<tr>\n<th>State</th>\n<th>isActive</th>\n<th>isCompleted</th>\n<th>isCancelled</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>New (optional initial state)</td>\n<td><code class=\"language-text\">false</code></td>\n<td><code class=\"language-text\">false</code></td>\n<td><code class=\"language-text\">false</code></td>\n</tr>\n<tr>\n<td>Active (default initial state)</td>\n<td><code class=\"language-text\">true</code></td>\n<td><code class=\"language-text\">false</code></td>\n<td><code class=\"language-text\">false</code></td>\n</tr>\n<tr>\n<td>Completing (transient state)</td>\n<td><code class=\"language-text\">true</code></td>\n<td><code class=\"language-text\">false</code></td>\n<td><code class=\"language-text\">false</code></td>\n</tr>\n<tr>\n<td>Cancelling (transient state)</td>\n<td><code class=\"language-text\">false</code></td>\n<td><code class=\"language-text\">false</code></td>\n<td><code class=\"language-text\">true</code></td>\n</tr>\n<tr>\n<td>Cancelled (final state)</td>\n<td><code class=\"language-text\">false</code></td>\n<td><code class=\"language-text\">true</code></td>\n<td><code class=\"language-text\">true</code></td>\n</tr>\n<tr>\n<td>Completed (final state)</td>\n<td><code class=\"language-text\">false</code></td>\n<td><code class=\"language-text\">true</code></td>\n<td><code class=\"language-text\">false</code></td>\n</tr>\n</tbody>\n</table>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqElEQVR42r2Syy8DURTGB30/EAsSgrCoRCxEWNkQia1FN1hIENV2HpogHiFWQhCxUlSIEGlR2umLir1qIwQL/Cno595pOy0bkYhJvpybme/+zplzDqPjAvhLMf8GVHMhqNJScmFJGi74M1DDijAKQej57EstuVjKH6NK8KCCP0K14EYl70YJfwaDEJL9BhIL6TkXuBB5Qf6wD0Vpk54ToWJDaHDso4nbQKOwjRZuHa0jTgL3gLGIUFh9kldt96PA6gctSgaCPPPhZzCDpzAQE81OL3SsxdC7ew/L4SMGDp7QunIN82YC3Vs36HHF0b97C7Mzhr6dBGqmogQuSkmY948kvkNpprLRMEwzUdQR0Vg+HoFp9hK101FY9u9gP3xAlzMOwfOI+rkrKG3+FJDiMtDF8xcwQ2cSVMsGoCAmhTUlWgGN+VYRzRMetE/soW3Mhc7JHVQ4TqFmU72UfjkXunTxKkOp9BlxAXlwWhv5bvOi2H4Co90LHev/2kMJmkzK0NXLV+RZfGTagS8TzCoobYKGrBSVLmedZGAKCrylocukUhVt9C8X+xMldRJz1E6XrgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cover\"\n        title=\"\"\n        src=\"/static/4b408a31e407236aee179777c392489b/37523/cover.png\"\n        srcset=\"/static/4b408a31e407236aee179777c392489b/e9ff0/cover.png 180w,\n/static/4b408a31e407236aee179777c392489b/f21e7/cover.png 360w,\n/static/4b408a31e407236aee179777c392489b/37523/cover.png 720w,\n/static/4b408a31e407236aee179777c392489b/0a867/cover.png 986w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>","excerpt":"러프하게 초안 정리 상태 코루틴 빌더 중단 함수는 컨티뉴에이션 객체를 다른 중단 함수로 전달해야 한다.\n(4장에서 다뤘는데, 중단 함수들의 콜스택과 연결되는 개념이다) 그래서 일반 함수가 중단 함수를 호출 할수는 없지만\n중단 함수는 일반 함수를 실행할 수 있다. 우리는 지금까지\n중단 함수는 코루틴을 실행할 수 있으며\n코루틴은 함수를 일시중단 할 수 있다고 배웠다. 그렇다면 중단 함수는 처음에 어떻게 실행 되는가?\n이것을 시작하는 지점이 코루틴 빌더다. 계층으로 표현해본다면 이런 느낌? 코루틴 빌더 중단 함수 or 코루틴 launch 빌더 새로운 일시중단 가능한 분기를 생성한다.\nlaunch 는 몇 번이든 호출하여 새로운 분기를 만들 수 있다. runBlocking 빌더 이 빌더가 실행된 스레드가 중단된다. async 빌더 비동기 태스크를 async 블록으로 감싸면 비동기 태스크가 실행되며 Deferred 타입을 반환한다.\ndeferred 객체의 await() 을 호출하면 결과 값을…","frontmatter":{"date":"2026.02.08","title":"코루틴 취소, 예외처리, 스코프 함수 (Coroutine DEEP DIVE)","categories":"Coroutine","author":"Winter","emoji":null,"thumbnail":{"publicURL":"/static/4b408a31e407236aee179777c392489b/cover.png"},"articleDescription":null,"articleKeywords":null,"articleModifiedDate":null},"fields":{"slug":"/coroutine-deep-dive/2-coroutine-builder-context-job-and-wait-children/"}},"next":{"id":"1c1bcd09-5227-54b1-bfaa-f902533444d4","html":"<p>본문에서 자주 사용하는 단축어 정의:</p>\n<blockquote>\n<p>cont: Continuation 객체의 줄임말.\n코드에서는 <code class=\"language-text\">cont</code> 또는 <code class=\"language-text\">continuation</code>으로 표기될 수 있음.</p>\n</blockquote>\n<hr>\n<h1 id=\"코틀린-코루틴을-배워야-하는-이유\" style=\"position:relative;\"><a href=\"#%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4%EC%9D%84-%EB%B0%B0%EC%9B%8C%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"코틀린 코루틴을 배워야 하는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코틀린 코루틴을 배워야 하는 이유</h1>\n<p>안드로이드에선 UI를 다루는 스레드가 하나만 존재한다.\nRestAPI 를 호출해서 데이터를 불러오고, 이를 UI 에 보여주기까지의 과정을 생각해보자.</p>\n<p><strong>스레드 전환:</strong>\n스레드에서 RestAPI 호출 후, <code class=\"language-text\">runOnUiThread { ... }</code> 를 통해 UI 스레드로 전환하는 방법이 있다.\n하지만 스레드가 실행 되었을때 멈출수 있는 방법이 없어 메모리 누수로 이어질 수 있다.\n스레드를 많이 생성하면 비용이 많이 들기도 하고, 코드가 길어지고 이해하기 어려워지는 문제도 있다.</p>\n<p><strong>콜백:</strong>\n대안으로 콜백 활용을 생각해볼 수 있다.\n취소할 수는 있지만 매우 번거로워서 쉽지 않은 일이다.\n그리고 여러번 중첩되어 사용되는 패턴인 “콜백 지옥”이 형성되어 읽기 어려운 코드가 될 수 있다.</p>\n<p><strong>RxJava &#x26; 리액티브 스트림:</strong>\n오랫동안 자바 진영에서 인기있는 해결책은 RxJava, 리액티브 스트림이 있다.\n이 방법은 스트림 내에서 일어나는 모든 연산을 시작, 처리 관찰할 수 있다.\n스레드 전환과 동시성 처리를 지원하기 때문에 애플리케이션 내의 연산을 병렬 처리할 수 있다.\n취소가 가능, 메모리 누수가 없어서 스레드를 적절하게 사용할 수 있다.\n단점이 있다면 구현하기 아주 복잡하다는 것이다.</p>\n<p><strong>코틀린 코루틴 사용:</strong>\n핵심은 코루틴을 특정 지점에서 멈추고, 이후에 재개할 수 있다는 것.\n코루틴을 사용하면 UI 스레드 블로킹 없이 중단 지점을 만들고 API 에서 데이터를 불러올 수 있다.\nAPI 를 불러온 뒤, 중단한 지점에서 다시 시작하여 UI 를 업데이트 할 수 있다.</p>\n<p>코루틴 중단 함수 안에선 비동기 코드를 마치 동기 코드처럼 순차적으로 작성할 수 있다.\n또는 비동기 코드를 병렬로 실행하여 (<code class=\"language-text\">async { }</code>, <code class=\"language-text\">await()</code>) 호출 결과를 더 빨리 받아볼 수 있다.\n이 모든것을 읽기 쉬운 간단한 코드로 구현할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">showNews</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  viewModelScope<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> config <span class=\"token operator\">=</span> async <span class=\"token punctuation\">{</span> <span class=\"token function\">getConfigFromApi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">val</span> news <span class=\"token operator\">=</span> async <span class=\"token punctuation\">{</span> <span class=\"token function\">gerNewsFromApi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">val</span> user <span class=\"token operator\">=</span> async <span class=\"token punctuation\">{</span> <span class=\"token function\">gerUserFromApi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n    view<span class=\"token punctuation\">.</span><span class=\"token function\">showNews</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span> news<span class=\"token punctuation\">.</span><span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>코루틴을 사용하면를 스레드를 재우는 대신 “코루틴”을 중단 시킨다.\n코루틴을 시작하는 비용은 스레드와 비교되지 않을만큼 저렴하다.</p>\n<h2 id=\"요약\" style=\"position:relative;\"><a href=\"#%EC%9A%94%EC%95%BD\" aria-label=\"요약 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>요약</h2>\n<p>코루틴은 스레드를 블로킹 하지 않고 중단 지점을 만들어서 비동기 로직을 실행한 뒤, 중단 지점에서 로직을 재개할 수 있다.\n이 동작은 어떤 비동기 로직 실행 방법보다 읽기 쉽게 작성할 수 있다.\n중단 함수는 취소가 가능하며, 스레드보다 비용이 적게 든다.</p>\n<p>추가 장점: 멀티플랫폼에서도 사용할 수 있다.</p>\n<h1 id=\"시퀀스-빌더\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%ED%80%80%EC%8A%A4-%EB%B9%8C%EB%8D%94\" aria-label=\"시퀀스 빌더 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시퀀스 빌더</h1>\n<p>코틀린에서는 제너레이터 대신 시퀀스를 생성할 때 사용하는 시퀀스 빌더를 제공한다.\n시퀀스 빌더는 필요할 때마다 값을 하나씩 계산하는 지연 처리를 한다.\n때문에 요구되는 연산을 최소한으로 수행해서 메모리 사용이 효율적이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">val</span> seq <span class=\"token operator\">=</span> sequence <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">yeild</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">yeild</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">yeild</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>num <span class=\"token keyword\">in</span> seq<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token comment\">// 123</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 알아야 할것은 각 숫자가 미리 생성되는 대신, 필요할 때마다 생성된다는 점이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">val</span> seq <span class=\"token operator\">=</span> requence <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Generating first\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">yeild</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Generating second\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">yeild</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Generating third\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">yeild</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Done\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>num <span class=\"token keyword\">in</span> seq<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"The next number is </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">num</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Generating first</span>\n<span class=\"token comment\">// The next number is 1</span>\n<span class=\"token comment\">// Generating second</span>\n<span class=\"token comment\">// The next number is 2</span>\n<span class=\"token comment\">// Generating third</span>\n<span class=\"token comment\">// The next number is 3</span>\n<span class=\"token comment\">// Done</span></code></pre></div>\n<p>시퀀스의 작동 방식에 대해 알아보자.\n“Generating first” 를 출력한 뒤 -> 숫자 1을 반환한다.\n이후 반복문에서 반환된 값을 반은 뒤 -> “Next number is 1”을 출력한다.\n여기서 반복문과 다른 점을 알아야 한다.</p>\n<p>main: <code class=\"language-text\">val num = seq.next()</code></p>\n<p>seq: <code class=\"language-text\">println(\"Generating first\")</code></p>\n<p>seq: <code class=\"language-text\">yeild(1)</code> &#x3C;- 1 반환</p>\n<p>main <code class=\"language-text\">println(\"The next number is $num\")</code> &#x3C;- 중단 후 시퀀스에서 반환한 값 1 출력</p>\n<p>main: <code class=\"language-text\">val num = seq.next()</code> &#x3C;- 중단 지점에서 시퀀스 다시 재개</p>\n<p>seq: <code class=\"language-text\">println(\"Generating second\")</code> &#x3C;- 중단 지점으로부터 다음 메시지 출력</p>\n<p>seq: <code class=\"language-text\">yeild(2)</code> &#x3C;- 2 반환</p>\n<p>main <code class=\"language-text\">println(\"The next number is $num\")</code> &#x3C;- 다시 중단 후 시퀀스에서 반환한 값 2 출력</p>\n<p>…</p>\n<p><strong>중단이 왜 필요한가?</strong>\n위 예시 패턴처럼, 중단이 가능하기 때문에 main 함수와 시퀀스 제너레이터가 번갈아가면서 실행될 수 있기 때문이라고 한다.</p>\n<p>시퀀스 빌더는 반환(yield)이 아닌 중단 함수를 사용하면 안 된다.\n중단이 필요하다면 데이터를 가져오기 위해 나중에 배울 플로우를 사용하는 것이 낫다.\n플로우 빌더가 작동하는 방식은 시퀀스 빌더와 비슷하지만, 플로우는 여러가지 코루틴 기능을 지원한다고 한다.</p>\n<p>다음 장에서 중단이 어떻게 작동하는지 살펴보자.</p>\n<h1 id=\"중단은-어떻게-작동할까\" style=\"position:relative;\"><a href=\"#%EC%A4%91%EB%8B%A8%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%A0%EA%B9%8C\" aria-label=\"중단은 어떻게 작동할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>중단은 어떻게 작동할까?</h1>\n<p>중단 함수는 코틀린 코투린의 핵심이다.\n코투린을 중단한다는 건 실행을 중간에 멈추는것을 의미한다.\n비디오 게임을 하다 멈추는 상황과 비슷하다.</p>\n<p>코루틴은 중단 되었을 때 cont 객체를 반환한다.\n이 객체는 게임을 저장하는 것과 비슷하다.\ncont 를 이용하면 멈췄던 곳에서 다시 코루틴을 실행할 수 있다.\n다른 스레드에서 시작할 수 있다.\n중단했을 때 코루틴은 어떤 자원도 사용하지 않는다.</p>\n<h2 id=\"재개\" style=\"position:relative;\"><a href=\"#%EC%9E%AC%EA%B0%9C\" aria-label=\"재개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>재개</h2>\n<p>코루틴은 <code class=\"language-text\">runBlocking</code> 이나 <code class=\"language-text\">launch</code> 와 같은 코루틴 빌더를 통해 만들 수 있다. </br>\n중단 함수 코루틴을 중단할 수 있는 함수다. </br>\n중단 함수는 반드시 코루틴 혹은 다른 중단 함수에 의해 호출 되어야 한다. </br>\n중단 함수는 중단할 수 있는곳이 필요하다. </br></p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Before\"</span></span><span class=\"token punctuation\">)</span>\n  suspendCoroutine<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"After\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Before</span></code></pre></div>\n<p>Before 와 After 사이에 중단을 하는 예시다.\n위 결과처럼 After 는 출력되지 않으며 코드는 실행된 상태로 유지된다.\nmain 함수가 끝나지 않았기 때문.\n프로그램은 멈춘채 재개되지 않는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Before\"</span></span><span class=\"token punctuation\">)</span>\n  suspendCoroutine<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> cont <span class=\"token operator\">-></span>\n    cont<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"After\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Before</span>\n<span class=\"token comment\">// After</span></code></pre></div>\n<p>cont 객체를 사용해서 코루틴을 중단한 후 곧바로 실행할 수 있다.\ncont 에서 resume 을 호출했기 때문에 After 를 호출할 수 있게 되었다.</p>\n<blockquote>\n<p>코틀린 1.3 이후부턴 <code class=\"language-text\">resumeWith()</code> 함수만 사용할 수 있다고 한다.</p>\n</blockquote>\n<p>suspendScope 에서 잠깐 동안 정지(sleep)된 뒤 재개되는 다른 스레드를 실행할수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Before\"</span></span><span class=\"token punctuation\">)</span>\n  suspendCoroutine<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> continuation <span class=\"token operator\">-></span>\n      thread <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Suspended\"</span></span><span class=\"token punctuation\">)</span>\n          Thread<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n          continuation<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span>Unit<span class=\"token punctuation\">)</span>\n          <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Resume\"</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"After\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Before</span>\n<span class=\"token comment\">// Suspended</span>\n<span class=\"token comment\">// (1초 후)</span>\n<span class=\"token comment\">// After</span>\n<span class=\"token comment\">// Resumed</span></code></pre></div>\n<p>위 예제로부터 다른 스레드가 재개하는 방식은 코투린을 이해하는데 중요하다.</p>\n<h2 id=\"값으로-재개하기\" style=\"position:relative;\"><a href=\"#%EA%B0%92%EC%9C%BC%EB%A1%9C-%EC%9E%AC%EA%B0%9C%ED%95%98%EA%B8%B0\" aria-label=\"값으로 재개하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>값으로 재개하기</h2>\n<p>suspend 함수에 기본적으로 Unit 을 인자로 넘길수 있고, 객체로 반환될 값의 타입을 지정할수도 있다</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// Unit 을 인자로 넘기는 경우</span>\n<span class=\"token keyword\">val</span> ret<span class=\"token operator\">:</span> Unit <span class=\"token operator\">=</span> \n  suspendCoroutine<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> cont<span class=\"token operator\">:</span> Continuation<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> <span class=\"token operator\">-></span>\n    cont<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span>Unit<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// 특정 타입을 인자로 넘기는 경우</span>\n<span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">val</span> ret<span class=\"token operator\">:</span> Unit <span class=\"token operator\">=</span> \n      \n  <span class=\"token keyword\">val</span> i<span class=\"token operator\">:</span> Int <span class=\"token operator\">=</span> suspendCoroutine<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> cont <span class=\"token operator\">-></span>\n    cont<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 42</span>\n  \n  <span class=\"token keyword\">val</span> str<span class=\"token operator\">:</span> String <span class=\"token operator\">=</span> suspendCoroutine<span class=\"token operator\">&lt;</span>String<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> cont <span class=\"token operator\">-></span>\n    cont<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Some text\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span> <span class=\"token comment\">// Some tex</span>\n\n  <span class=\"token keyword\">val</span> b<span class=\"token operator\">:</span> Boolean <span class=\"token operator\">=</span> suspendCoroutine<span class=\"token operator\">&lt;</span>Boolean<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> cont <span class=\"token operator\">-></span>\n      cont<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>RestAPI 호출에서 응용하는 방법.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Before\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">val</span> user <span class=\"token operator\">=</span> suspendCoroutine<span class=\"token operator\">&lt;</span>User<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    requestUser <span class=\"token punctuation\">{</span> user <span class=\"token operator\">-></span>\n      cont<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>    \n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"After\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Before</span>\n<span class=\"token comment\">// (1초 후)</span>\n<span class=\"token comment\">// User(name=Test)</span>\n<span class=\"token comment\">// After</span></code></pre></div>\n<h2 id=\"예외로-재개하기\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%99%B8%EB%A1%9C-%EC%9E%AC%EA%B0%9C%ED%95%98%EA%B8%B0\" aria-label=\"예외로 재개하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예외로 재개하기</h2>\n<p>우리가 사용하는 모든 함수는 값을 반환하거나 예외를 던진다. suspendCoroutine 또한 마찬가지.</p>\n<p>보통 네트워크 관련 예외를 알릴 때 사용할 수 있다.</p>\n<p><code class=\"language-text\">resume()</code> 호출:  인자로 들어온 데이터를 반환한다. </br>\n<code class=\"language-text\">resumeWithException()</code> 호출: 중단된 지점에서 인자로 넣어준 예외를 던진다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> MyException <span class=\"token operator\">:</span> <span class=\"token function\">Throwable</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Just an exception\"</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    suspendCoroutine<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> cont <span class=\"token operator\">-></span>\n      cont<span class=\"token punctuation\">.</span><span class=\"token function\">resumeWithException</span><span class=\"token punctuation\">(</span><span class=\"token function\">MyException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> MyExeption<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Caught!\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Caught!</span></code></pre></div>\n<h2 id=\"함수가-아닌-코루틴을-중단시킨다\" style=\"position:relative;\"><a href=\"#%ED%95%A8%EC%88%98%EA%B0%80-%EC%95%84%EB%8B%8C-%EC%BD%94%EB%A3%A8%ED%8B%B4%EC%9D%84-%EC%A4%91%EB%8B%A8%EC%8B%9C%ED%82%A8%EB%8B%A4\" aria-label=\"함수가 아닌 코루틴을 중단시킨다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>함수가 아닌 코루틴을 중단시킨다</h2>\n<p>함수가 아닌 코루틴을 중단하는 것.\n중단 함수는 코루틴이 아니다.\n중단 함수는 코루틴을 중단할 수 있는 함수라고 한다.</p>\n<p>아래 예시를 보자. 이 이예시는 의도와 달리 종료되지 않는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">var</span> continuatino<span class=\"token operator\">:</span> Continuation<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span><span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n<span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">suspendAndSetContinuation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  suspendCoroutine<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> cont <span class=\"token operator\">-></span>\n    continuation <span class=\"token operator\">=</span> cont\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Before\"</span></span><span class=\"token punctuation\">)</span>\n    \n  <span class=\"token function\">suspendAndSetContinuation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  continuation<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span>Unit<span class=\"token punctuation\">)</span>\n    \n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>After<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Before</span></code></pre></div>\n<p>여기서 resume() 은 호출되지 않는다.\n다른 스레드나 다른 코루틴으로 재개하지 않으면 프로그램은 실행된 상태로 유지된다.</p>\n<p>이 섹션의 첫 내용을 다시 상기하며 개념 정리: </br>\n<strong>코루틴, 코루틴 스코프:</strong> 둘 다 코루틴을 지칭한다. </br>\n<strong>중단 함수:</strong> 코루틴을 중단할 수 있는 함수다.</p>\n<blockquote>\n<p>중단 함수는 코루틴을 실행 시킬수 있는 함수.</p>\n</blockquote>\n<blockquote>\n<p>코루틴은 일시 중단과 재개를 시킬 수 있다.</p>\n</blockquote>\n<h1 id=\"코루틴의-실제-구현\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4%EC%9D%98-%EC%8B%A4%EC%A0%9C-%EA%B5%AC%ED%98%84\" aria-label=\"코루틴의 실제 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴의 실제 구현</h1>\n<ul>\n<li>\n<p>중단 함수가 상태를 가지는 시점: 함수가 시작할때와 중단 함수가 호출 되었을때.\n이렇듯, 중단 함수가 상태를 가진다는 점에서 상태 머신 (state machine) 과 비슷하다.</p>\n</li>\n<li>\n<p>cont 객체는 상태를 나타내는 숫자와 로컬 데이터를 가지고 있다.</p>\n</li>\n<li>\n<p>호출된 함수의 cont 는 호출한 함수의 cont 를 감싸면서 체인을 형성한다.\n이 체인이 코루틴의 콜 스택 역할을 한다 — 함수가 끝나면 이 체인을 따라 되돌아간다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">호출 순서<span class=\"token operator\">:</span> <span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token function\">b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Continuation 체인</span>\nc<span class=\"token punctuation\">.</span>cont <span class=\"token operator\">-></span> b<span class=\"token punctuation\">.</span>cont <span class=\"token operator\">-></span> a<span class=\"token punctuation\">.</span>cont <span class=\"token comment\">// 각각 이전 호출자를 참조</span>\n\n<span class=\"token comment\">// 반환 순서</span>\nc 완료 → b resume → b 완료 → a resume → a 완료</code></pre></div>\n</li>\n</ul>\n<h2 id=\"컨티뉴에이션-전달-방식\" style=\"position:relative;\"><a href=\"#%EC%BB%A8%ED%8B%B0%EB%89%B4%EC%97%90%EC%9D%B4%EC%85%98-%EC%A0%84%EB%8B%AC-%EB%B0%A9%EC%8B%9D\" aria-label=\"컨티뉴에이션 전달 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컨티뉴에이션 전달 방식</h2>\n<p>중단 함수는 여러 방식으로 구현할 수 있다.\n코틀린 팀은 <strong>컨티뉴에이션 전달 방식</strong>(continuation-passing style)을 택했다고 한다.</p>\n<p>컨티뉴에이션은 함수에서 함수로 파라미터를 통해 전달된다.\n관례상 컨티뉴에이션은 마지막 파라미터로 정렬 한다고 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> User<span class=\"token operator\">?</span>\n<span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span>user<span class=\"token operator\">:</span> User<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">checkAvailability</span><span class=\"token punctuation\">(</span>flight<span class=\"token operator\">:</span> Flight<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Boolean\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span>continuation<span class=\"token operator\">:</span> Continuatoin<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span>\n  user<span class=\"token operator\">:</span> User<span class=\"token punctuation\">,</span> \n  continuation<span class=\"token operator\">:</span> Continuation<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any\n<span class=\"token keyword\">fun</span> <span class=\"token function\">checkAvailability</span><span class=\"token punctuation\">(</span>\n  flight<span class=\"token operator\">:</span> Flight<span class=\"token punctuation\">,</span>\n  continuation<span class=\"token operator\">:</span> Continuation<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any</code></pre></div>\n<p>중단 함수 내부를 들여다보면 원래 선언했던 형태와 반환 타입이 Any 또는 Any? 로 바뀌었다.\n그 이유는, 중단 함수를 실행하는 도중에 중단되면 선언된 타입의 값을 반환하지 않을수 있기 때문이라고 한다.\n이때 중단 함수는 <code class=\"language-text\">COROUTINE_SUSPENDED</code>라는 특별한 마커를 반환한다.</p>\n<p>지금은 <code class=\"language-text\">getUser()</code> 함수가 <code class=\"language-text\">User?</code> or <code class=\"language-text\">COROUTINE_SUSPENDED</code> 를 반환할 수 있기 때문에,\n이 결과와 가장 가까운 슈퍼 타입인 <code class=\"language-text\">Any?</code> 로 지정된 것이다.</p>\n<h2 id=\"아주-간단한-함수\" style=\"position:relative;\"><a href=\"#%EC%95%84%EC%A3%BC-%EA%B0%84%EB%8B%A8%ED%95%9C-%ED%95%A8%EC%88%98\" aria-label=\"아주 간단한 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>아주 간단한 함수</h2>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Before\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 중단 함수</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"After\"</span></span><span class=\"token punctuation\">)</span>    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">myFunction</code> 함수의 시그니처(signature)를 다음과 같이 추론할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span>continuation<span class=\"token operator\">:</span> Continuation<span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any</code></pre></div>\n<p>이번에 알아볼 것은, 이 함수는 상태를 저장하기 위해 자신만의 cont 객체가 필요할것이다.\n이 상태명을 <code class=\"language-text\">MyFunctionContinuation</code> 이라고 가정해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">val continuation = MyFunctionContinuation(continuation)</code></pre></div>\n<p><code class=\"language-text\">myFunction</code> 함수가 실행될 때 파라미터인 continuation 을 자신만의 컨티뉴에이션인 <code class=\"language-text\">MyFunctionContinuation</code> 으로 포장한다.</p>\n<p>이미 래핑된 컨티뉴에이션이면 그대로 두고, 아니면 새로 래핑한다.\n만약 코루틴이 재실행되고 있으면 컨티뉴에이션 객체는 이미 래핑되어 있을것이므로 컨티뉴에이션 객체를 그대로 둬야한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">val</span> continuation <span class=\"token operator\">=</span> \n    continuation <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> MyFunctionContinuation \n    <span class=\"token operator\">?:</span> <span class=\"token function\">MyFunctionContinuation</span><span class=\"token punctuation\">(</span>continuation<span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">myFunction</code> 함수가 시작되는 지점은 함수의 시작점과 중단 이후 재개 시점 두 곳이다.\n현재 상태를 저장하려면 <code class=\"language-text\">label</code> 이라는 필드를 사용한다.\n함수가 처음 시작할 때 이 <code class=\"language-text\">label</code> 값은 0으로 설정된다.\n이후 중단되기 전에 다음 상태로 설정되어 코루틴이 재개될 시점을 알 수 있게 도와준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// myFunction 의 세부 구현을 간단하게 표현한 예시</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span>continuation<span class=\"token operator\">:</span> Continuation<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">val</span> continuation <span class=\"token operator\">=</span> continuation <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> MyFunctionContinuation\n      <span class=\"token operator\">?:</span> <span class=\"token function\">MyFunctionContinuation</span><span class=\"token punctuation\">(</span>continuation<span class=\"token punctuation\">)</span>\n      \n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>continuation<span class=\"token punctuation\">.</span>label <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Before\"</span></span><span class=\"token punctuation\">)</span>\n      continuation<span class=\"token punctuation\">.</span>label <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> continuation<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> COROUTINE_SUSPEND<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> COROUTINE_SUSPEND\n      <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>continuation<span class=\"token punctuation\">.</span>label <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"After\"</span></span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> Unit\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Impossible\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 코드에 중요한 부분이 있다.\n<code class=\"language-text\">delay</code> 에 의해 중단된 경우, <code class=\"language-text\">delay</code> 로부터 <code class=\"language-text\">COROUTINE_SUSPEND</code> 가 반환된다.\n<code class=\"language-text\">myFunction</code> 은 <code class=\"language-text\">COROUTINE_SUSPEND</code>를 반환한다.\n<code class=\"language-text\">myFunction</code>을 호출한 함수부터 시작해 콜 스택에 있는 모든 함수도 똑같다.</p>\n<p>즉, 중단이 일어나면 콜 스택에 있는 모든 함수가 <code class=\"language-text\">COROUTINE_SUSPEND</code> 를 반환 받으며,\n결과적으로 아래와 같이 중단된 코루틴의 실행이 종료된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Before\"</span></span><span class=\"token punctuation\">)</span>\n    \n  <span class=\"token comment\">// 여기서 중단되면 main도 COROUTINE_SUSPENDED 반환</span>\n  <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \n    \n  <span class=\"token comment\">// 재개후 실행됨</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"After\"</span></span><span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Before</span>\n<span class=\"token comment\">// After</span></code></pre></div>\n<p>중단된 코루틴을 실행하던 스레드를 실행 가능한 코드가 사용할 수 있게된다.</p>\n<blockquote>\n<p>만약 <code class=\"language-text\">delay</code> 호출이 <code class=\"language-text\">COROUTINE_SUSPEND</code>를 반환하지 않고 <code class=\"language-text\">Unit</code>을 반환하면 어떻게 될까?\n그냥 중단 없이 다음 코드로 넘어가는 일반적인 함수 호출이 된다.</p>\n</blockquote>\n<p>다음으로 컨티뉴에이션 객체다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">cont <span class=\"token operator\">=</span> <span class=\"token keyword\">object</span> <span class=\"token operator\">:</span> <span class=\"token function\">ContinuatoinIm</span><span class=\"token punctuation\">(</span>continuation<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> result<span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n  <span class=\"token keyword\">var</span> label <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  \n  <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">invokeSuspend</span><span class=\"token punctuation\">(</span>`$result`<span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Any<span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>result <span class=\"token operator\">=</span> `$result`<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"상태를-가진-함수\" style=\"position:relative;\"><a href=\"#%EC%83%81%ED%83%9C%EB%A5%BC-%EA%B0%80%EC%A7%84-%ED%95%A8%EC%88%98\" aria-label=\"상태를 가진 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>상태를 가진 함수</h2>\n<p>함수가 중단된 후 다시 사용할 지역 변수나 파라미터같은 상태를 가지고 있다면,\n함수의 컨티뉴에이션 객체에 상태를 저장해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">myFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>\"Before<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">var</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 중단 함수</span>\n  counter<span class=\"token operator\">++</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>\"Counter<span class=\"token operator\">:</span> $counter<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>\"After<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>counter 는 0 과 1로 표시된 두 상태에서 사용되므로 컨티뉴에이션을 통해 이를 저장해야 한다.\n함수 내에 사용되던 값들은 중단 직전에 저장되고, 이후 함수가 재개될 때 복구된다.</p>\n<h2 id=\"값을-받아-재개되는-함수\" style=\"position:relative;\"><a href=\"#%EA%B0%92%EC%9D%84-%EB%B0%9B%EC%95%84-%EC%9E%AC%EA%B0%9C%EB%90%98%EB%8A%94-%ED%95%A8%EC%88%98\" aria-label=\"값을 받아 재개되는 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>값을 받아 재개되는 함수</h2>\n<p>중단 함수로부터 값을 받아야 하는 경우는 좀 더 복잡하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">printUser</span><span class=\"token punctuation\">(</span>token<span class=\"token operator\">:</span> String<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Before\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">val</span> userId <span class=\"token operator\">=</span> <span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 중단 함수</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Got userId: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">userId</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">val</span> userName <span class=\"token operator\">=</span> <span class=\"token function\">getUserName</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 중단 함수</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token function\">User</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> userName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"After\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">getUserId</code> 와  <code class=\"language-text\">getUserName</code> 이라는 두 가지 중단 함수가 있다.\ntoken 이라는 파라미터를 받으면 중단 함수는 특정 값을 반환한다.</p>\n<p>함수가 재개되었다면 결과는 <code class=\"language-text\">Result.Success(value)</code> 가 되며, 이 값을 얻어 사용할 수 있다.\n함수가 예외로 재개되었다면 결과는 <code class=\"language-text\">Result.Failuer(exception)</code> 이 되며 이 때는 예외를 던진다.</p>\n<h2 id=\"콜스택\" style=\"position:relative;\"><a href=\"#%EC%BD%9C%EC%8A%A4%ED%83%9D\" aria-label=\"콜스택 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>콜스택</h2>\n<p>코루틴을 재개할 때 콜 스택을 사용할수는 없다.\n코루틴을 중단하면 스레드를 반환해 콜스택에 있는 정보가 사라지니까.\n그래서 컨티뉴에이션 객체가 콜 스택의 역할을 대신 한다.</p>\n<p>서두에서 언급했듯  호출된 함수의 cont 는 호출한 함수의 cont 를 감싸면서 체인을 형성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">호출 순서<span class=\"token operator\">:</span> <span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token function\">b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Continuation 체인</span>\nc<span class=\"token punctuation\">.</span>cont <span class=\"token operator\">-></span> b<span class=\"token punctuation\">.</span>cont <span class=\"token operator\">-></span> a<span class=\"token punctuation\">.</span>cont <span class=\"token comment\">// 각각 이전 호출자를 참조</span>\n\n<span class=\"token comment\">// 반환 순서</span>\nc 완료 → b resume → b 완료 → a resume → a 완료</code></pre></div>\n<h2 id=\"중단-함수의-성능\" style=\"position:relative;\"><a href=\"#%EC%A4%91%EB%8B%A8-%ED%95%A8%EC%88%98%EC%9D%98-%EC%84%B1%EB%8A%A5\" aria-label=\"중단 함수의 성능 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>중단 함수의 성능</h2>\n<p>일반적인 함수 대신 중단 함수를 사용하면 비용은 어떻게 될까?\n코루틴 내부 구현을 보면 비용이 클 거라 생각하겠지만 실제로는 그렇지 않다.\n지역변수를 복사하지 않고 새로운 변수가 메모리 내 특정 값을 가리키게 한다.\n컨티뉴에이션 객체를 생성할 때 비용이 어느정도 들지만, 마찬가지로 큰 문제는 아니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqElEQVR42r2Syy8DURTGB30/EAsSgrCoRCxEWNkQia1FN1hIENV2HpogHiFWQhCxUlSIEGlR2umLir1qIwQL/Cno595pOy0bkYhJvpybme/+zplzDqPjAvhLMf8GVHMhqNJScmFJGi74M1DDijAKQej57EstuVjKH6NK8KCCP0K14EYl70YJfwaDEJL9BhIL6TkXuBB5Qf6wD0Vpk54ToWJDaHDso4nbQKOwjRZuHa0jTgL3gLGIUFh9kldt96PA6gctSgaCPPPhZzCDpzAQE81OL3SsxdC7ew/L4SMGDp7QunIN82YC3Vs36HHF0b97C7Mzhr6dBGqmogQuSkmY948kvkNpprLRMEwzUdQR0Vg+HoFp9hK101FY9u9gP3xAlzMOwfOI+rkrKG3+FJDiMtDF8xcwQ2cSVMsGoCAmhTUlWgGN+VYRzRMetE/soW3Mhc7JHVQ4TqFmU72UfjkXunTxKkOp9BlxAXlwWhv5bvOi2H4Co90LHev/2kMJmkzK0NXLV+RZfGTagS8TzCoobYKGrBSVLmedZGAKCrylocukUhVt9C8X+xMldRJz1E6XrgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cover\"\n        title=\"\"\n        src=\"/static/4b408a31e407236aee179777c392489b/37523/cover.png\"\n        srcset=\"/static/4b408a31e407236aee179777c392489b/e9ff0/cover.png 180w,\n/static/4b408a31e407236aee179777c392489b/f21e7/cover.png 360w,\n/static/4b408a31e407236aee179777c392489b/37523/cover.png 720w,\n/static/4b408a31e407236aee179777c392489b/0a867/cover.png 986w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>","frontmatter":{"date":"2026.02.01","title":"코틀린 코루틴 이해하기 (Coroutine DEEP DIVE)","categories":"Coroutine","author":"Winter","emoji":null},"fields":{"slug":"/coroutine-deep-dive/1-understnad-kotlin-coroutine/"}},"prev":{"id":"3f2ca060-a674-58c5-b6ff-8ec784120d18","html":"<h1 id=\"취소\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%86%8C\" aria-label=\"취소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취소</h1>\n<h2 id=\"기본적인-취소\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-%EC%B7%A8%EC%86%8C\" aria-label=\"기본적인 취소 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본적인 취소</h2>\n<blockquote>\n<p>코루틴을 취소하기 위해 사용되는 예외(exception)은 <code class=\"language-text\">CancellationException</code> or 이 예외의 서브 타입이어야 한다.</p>\n</blockquote>\n<p>Job 인터페이스는 취소하기 위한 <code class=\"language-text\">cancel()</code> 메소드를 가지고 있다.</p>\n<p>이 메소드를 호출할 때</p>\n<ul>\n<li>호출 시점에 잡을 끝낸다.</li>\n<li>잡이 자식을 가지고 있다면, 자식들도 취소된다. 부모는 영향받지 않는다.</li>\n<li>취소된 잡은 더이상 코루틴의 부모로 사용될 수 없다.</li>\n<li>취소된 잡은 <code class=\"language-text\">Cancelling</code> 상태가 되었다가 <code class=\"language-text\">Cannceled</code> 상태로 바뀐다.</li>\n</ul>\n<p><code class=\"language-text\">join()</code> 메소드도 알고 넘어가자.\n<code class=\"language-text\">cancel()</code> 이 호출된 뒤, 다음 작업을 진행하기 전에 <code class=\"language-text\">join()</code> 을 호출하면 취소 과정이 완료되는걸 기다리게 된다.</p>\n<p>우리는 명시적인 <code class=\"language-text\">cancel()</code> 시점을 핸들링 하기 위해 <code class=\"language-text\">join()</code> 을 사용하는 사례가 많을거다.\n그래서 이 둘을 세트로 호출할 수 있는 확장 함수 <code class=\"language-text\">cancelAndJoin()</code>를 잘 활용하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> Job<span class=\"token punctuation\">.</span><span class=\"token function\">cancellAndJoin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Job()</code> 하위에 생성된 수많은 자식 잡을 한 번에 취소할 수 있다는 점도 알고 가자.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// suspend fun main(): Unit = coroutineScope { ...</span>\n<span class=\"token keyword\">val</span> job <span class=\"token operator\">=</span> <span class=\"token function\">Job</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">launch</span><span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">repeat</span><span class=\"token punctuation\">(</span><span class=\"token number\">1_000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> i <span class=\"token operator\">-></span>\n    <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Printing </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">i</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>    \n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1100</span><span class=\"token punctuation\">)</span>\njob<span class=\"token punctuation\">.</span><span class=\"token function\">cancelAndJoing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Canceeld successfully\"</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Printing 0</span>\n<span class=\"token comment\">// Printing 1</span>\n<span class=\"token comment\">// Printing 2</span>\n<span class=\"token comment\">// Printing 3</span>\n<span class=\"token comment\">// Printing 4</span>\n<span class=\"token comment\">// Cancelled successfully</span></code></pre></div>\n<h2 id=\"취소는-어떻게-작동하는가\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%86%8C%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%98%EB%8A%94%EA%B0%80\" aria-label=\"취소는 어떻게 작동하는가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취소는 어떻게 작동하는가?</h2>\n<p><code class=\"language-text\">Job</code> 이 취소되면</p>\n<ul>\n<li><code class=\"language-text\">Cancelling</code> 상태로 바뀐다.</li>\n<li>상태가 바뀐 뒤, 첫 번 째 중단점에서 <code class=\"language-text\">CancellationException</code> 예외를 던진다.</li>\n</ul>\n<p>예외는 <code class=\"language-text\">try-catch</code> 로 잡을 수도 있지만 다시 던지는(<code class=\"language-text\">throw</code>)게 좋다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// coroutineScope { ...</span>\n<span class=\"token keyword\">val</span> job <span class=\"token operator\">=</span> <span class=\"token function\">Job</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">launch</span><span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">repeat</span><span class=\"token punctuation\">(</span><span class=\"token number\">1_000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> i <span class=\"token operator\">-></span>\n      <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Printing </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">i</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> CancellationException<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> e\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1100</span><span class=\"token punctuation\">)</span>\njob<span class=\"token punctuation\">.</span><span class=\"token function\">cancelAndJoin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Cancelled successfully\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Printing 0</span>\n<span class=\"token comment\">// Printing 1</span>\n<span class=\"token comment\">// Printing 2</span>\n<span class=\"token comment\">// Printing 3</span>\n<span class=\"token comment\">// Printing 4</span>\n<span class=\"token comment\">// JobCancellationException...</span>\n<span class=\"token comment\">// Cancelled successfully</span></code></pre></div>\n<p>취소된 코루틴이 단지 멈추는게 아니라 내부적으로 예외를 사용해 취소된다는걸 알아야 한다.\n따라서 <code class=\"language-text\">finally</code> 블록 안에서 모든것을 정리할 수 있다. (파일 IO나 DB 연결 닫기 등의 정리)</p>\n<h2 id=\"취소-중-코루틴을-한-번-더-호출하기\" style=\"position:relative;\"><a href=\"#%EC%B7%A8%EC%86%8C-%EC%A4%91-%EC%BD%94%EB%A3%A8%ED%8B%B4%EC%9D%84-%ED%95%9C-%EB%B2%88-%EB%8D%94-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B8%B0\" aria-label=\"취소 중 코루틴을 한 번 더 호출하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>취소 중 코루틴을 한 번 더 호출하기</h2>\n<p>모든 코루틴은 모든 자원을 정리할 필요가 있는 한 계속해서 실행될 수 있다. (위에서 언급한 파일 IO나 DB 연결 닫기 등의 자원 정리를 말하는 듯)</p>\n<p>하지만 자원 정리 과정 중에 중단을 허용하지는 않는다. <code class=\"language-text\">Job</code> 은 이미 <code class=\"language-text\">Cancelling</code> 상태가 되었기 때문에.</p>\n<p>정리 과정 중에</p>\n<ul>\n<li>새로운 코루틴을 시작하려고 하면 무시된다.</li>\n<li>중단하려고 하면 <code class=\"language-text\">CancellationException</code> 을 던진다.</li>\n</ul>\n<p>코루틴이 이미 취소 되었을 때 중단 함수를 반드시 호출해야 하는 경우도 있다.\n예를 들어, DB의 변경 사항을 롤백하는 경우이다.\n이런 경우 함수 콜을 <code class=\"language-text\">withContext(NonCancellable) { ... }</code> 로 포장하는 방법이 많이 사용되고 있다.\n블록 내부에서 잡은 액티브 상태를 유지하며, 중단 함수를 원하는 만큼 호출할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// suspend fun main(): Unit = coroutineScope {</span>\n<span class=\"token keyword\">val</span> job <span class=\"token operator\">=</span> <span class=\"token function\">Job</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">launch</span><span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Coroutine finished\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Finally\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">withContext</span><span class=\"token punctuation\">(</span>NonCancellable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000L</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Cleanup done\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n  job<span class=\"token punctuation\">.</span><span class=\"token function\">cnacelAndJoin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Done\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Finally</span>\n<span class=\"token comment\">// Cleanup done</span>\n<span class=\"token comment\">// Done</span></code></pre></div>\n<h2 id=\"invokeoncompletion\" style=\"position:relative;\"><a href=\"#invokeoncompletion\" aria-label=\"invokeoncompletion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>invokeOnCompletion</h2>\n<p><code class=\"language-text\">invokeOnCompletion</code>: Job 이 <code class=\"language-text\">Completed</code> 나 <code class=\"language-text\">Cancelled</code> 와 같은 마지막 상태에 도달했을 때 호출되는 핸들러다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// suspend fun main(): Unit = coroutineScope \nval job = launch {\n  delay(1000)\n}\njob.invokeOnCompletion { exeption: Trowable? ->\n  println(\"Finished\")\n}\ndelay(400)\njob.cancelAndJoin()\n\n// Finished</code></pre></div>\n<p><code class=\"language-text\">invokeOnCompletion</code> 핸들러의 파라미터로 넘어오는 예외 종류:</p>\n<ul>\n<li>Job 이 예외 없이 끝나면 null</li>\n<li>코루틴이 취소되면 <code class=\"language-text\">CancellationException</code></li>\n<li>코루틴을 종료시킨 예외일수 있음 (이에 대해선 추후 배울거라고 함)</li>\n</ul>\n<p>잡이 <code class=\"language-text\">invokeOnCompletion</code> 호출되기 전에 완료되면 핸들러는 즉시 호출된다는 특징도 있다.</p>\n<h2 id=\"중단될-수-없는걸-중단하기\" style=\"position:relative;\"><a href=\"#%EC%A4%91%EB%8B%A8%EB%90%A0-%EC%88%98-%EC%97%86%EB%8A%94%EA%B1%B8-%EC%A4%91%EB%8B%A8%ED%95%98%EA%B8%B0\" aria-label=\"중단될 수 없는걸 중단하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>중단될 수 없는걸 중단하기</h2>\n<blockquote>\n<p><code class=\"language-text\">yield()</code>\nor\n<code class=\"language-text\">Job</code> 의 상태 추적하기</p>\n</blockquote>\n<p>취소는 중단점에서 일어난다.\n때문에 중단점이 없으면 취소를 할 수 없다.</p>\n<p>원하는 시점에 취소할 수 없는 중단 함수가 있다고 가정해보자.\n1초 뒤에 실행이 취소 되어야 하는데, 실제론 3분이 넘게 걸리는 경우엔 어떻게 해야할까?</p>\n<p><code class=\"language-text\">yield()</code> 를 호출하는 방법이 있다.\nyield 는 코루틴을 중단하고 즉시 재실행한다.\n중단점이 생겼기 때문에 취소를 포함해 중단중에 필요한 모든 작업을 할 수 있는 기회가 주어진다.\n(첫 장에서 배웠던 시퀀스를 떠올려보자)</p>\n<p>중단 불가능하면서 CPU 집약적이거나 시간 집약적인 연산들의 경우, 각 연산들 사이에 yield 를 사용하는게 좋다</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">cpuIntensiveOperations</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> \n  <span class=\"token function\">withContext</span><span class=\"token punctuation\">(</span>Dispatchers<span class=\"token punctuation\">.</span>Default<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">cpuIntensiveOperation1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">yield</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">cpuIntensiveOperation2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">yield</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">cpuIntensiveOperation3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다른 방법은 잡의 상태를 추적하는 것이다.\n코루틴 빌더 내부에서 this(리시버)는 빌더의 스코프를 참조하고 있다.\n따라서 <code class=\"language-text\">coroutineContext.job</code> 에 접근해 현재 상태를 확인할 수 있다.</p>\n<p>Job 은 코루틴이 액티브한지 확인하는데 사용되는데,\n액티브 상태를 간단하게 확인할 수 있는 <code class=\"language-text\">isActive</code> 라는 확장 함수를 사용할 수 있다.</p>\n<p>코루틴 내부 반복문 안에서 <code class=\"language-text\">isActive</code> 상태일때만 특정 메시지를 출력하게 만드는데 활용할 수 있다.\n아니면 <code class=\"language-text\">Job</code> 이 액티브 상태가 아니면 <code class=\"language-text\">CancellationException</code> 을 던지는 <code class=\"language-text\">ensureActive()</code> 함수를 사용하는 방법도 있다.</p>\n<p><code class=\"language-text\">isActive</code>: 잡의 액티브 상태를 조회하고 Boolean 결과를 반환한다.</p>\n<p><code class=\"language-text\">ensureActive()</code>: 잡이 더이상 액티브 상태가 아니면 예외를 던진다.</p>\n<h2 id=\"suspendcancellablecoroutine\" style=\"position:relative;\"><a href=\"#suspendcancellablecoroutine\" aria-label=\"suspendcancellablecoroutine permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>suspendCancellableCoroutine</h2>\n<blockquote>\n<p><code class=\"language-text\">invokeOnCancellation</code>: 코루틴이 취소 되었을때 행동을 정의할 수 있다. (특정 라이브러리 실행 취서 or 자원 해제를 할 때 등) <code class=\"language-text\">invokeOnCompletion</code> 과는 다르다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">someTask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> suspendCancellableCoroutine <span class=\"token punctuation\">{</span> cont <span class=\"token operator\">-></span>\n  cont<span class=\"token punctuation\">.</span><span class=\"token function\">invokeOnCancellation</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 정리 작업을 실행한다.</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 나머지 구현 부분.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>대표적으로 Retrofit 이 내부적으로 <code class=\"language-text\">suspendCancellableCoroutine</code> 를 사용하는 사례를 볼 수 있으며,\n코루틴이 취소되면 <code class=\"language-text\">invokeOnCancellation</code> 핸들러로 api 호출을 취소 처리하는 모습을 볼 수 있다.</p>\n<h1 id=\"예외처리\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC\" aria-label=\"예외처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예외처리</h1>\n<p>보통의 프로그램은 예외를 try-catch 하지 않으면 종료된다.\n코루틴도 비슷하다.\n알아둬야 할 것은 코루틴 빌더는 부모도 종료 시키고, 취소된 부모는 모든 자식들을 취소시킨다.</p>\n<p>(아래) 자식이 부모로, 부모가 자식들에게 취소를 전파되며 취소되는 모습</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCklEQVR42oVSXWvTYBROO50dXceabgUnU8fwWpBd7Er/gTfitXe98Q8IXuQPuAtvql4VigMJNpZWaLJQYumHCbZrpFnavklNm2alsaWb7AfEc8o6toH2wOENOe/7nPM8z6GoOTEmZGUwGKw7jhPBZFl2Af97nueTJOkGwzD+eRiUR1G+6QmXTUI+tNvtrmEYTdM05U6ncxdr6XQ6xPP8Zi6Xuw1NFv+H5zufwC9yYiSfz9+rVqtreBYKhU1VVYNYZ1lpmc1m7wDY+jxAKhaL3YzH42GgtDqjiJFMJoMcx0USiUTAkhKBU56nz8pC9LT4NfxPMMuyVmu12oau65FLYL7Z5Ei1UqnQf0BPYBH0LCvggZZXNQN6eP52nOfENGutVus7aFWfTCZPz+sLaML0W9MWHdt+32w2VUil3+9zo9EoNDPqCnApn9+WZXm3WCzulsvlx2BC9PrFpCAEK9Wfj+TDxkOY9ImiKDvS9QlR6EajsV2v1+/D4yUEQMroKCYh5BbeM1Op6NFB9sGZIERhE/yebS+1VHULGG3hal00do+P38Ba/ILUe73ut/Fw+BopQx4ahAzdk5NnHvMi4H75JHfZj43u531zktp/57runolhGEeg/Y9er7cxBQQtQplMZg1MoGG3aE3TlkVRRFNodBUnxO72HkMrr15GdMjxW2alVCpdvAOZwmjiX6ZzWxV3by3TAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"\"\n        src=\"/static/0302470570d27c9ff818398906ecd5f2/37523/0.png\"\n        srcset=\"/static/0302470570d27c9ff818398906ecd5f2/e9ff0/0.png 180w,\n/static/0302470570d27c9ff818398906ecd5f2/f21e7/0.png 360w,\n/static/0302470570d27c9ff818398906ecd5f2/37523/0.png 720w,\n/static/0302470570d27c9ff818398906ecd5f2/302a4/0.png 1080w,\n/static/0302470570d27c9ff818398906ecd5f2/07a9c/0.png 1440w,\n/static/0302470570d27c9ff818398906ecd5f2/4219b/0.png 5115w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"코루틴-종료-멈추기-supervisorjob\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%A2%85%EB%A3%8C-%EB%A9%88%EC%B6%94%EA%B8%B0-supervisorjob\" aria-label=\"코루틴 종료 멈추기 supervisorjob permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴 종료 멈추기. SupervisorJob</h2>\n<p>SupervisorJob 은 위 그림처럼 한 자식에서 발생한 모든 예외를 무시할 수 있다.\n즉, 전파되지 않는다.</p>\n<p>(아래) SupervisorJob 을 사용한 부모는 exception 을 전파를 무시하는 모습</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.222222222222214%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/0lEQVR42mNgwAPq6+uZbt26pfX48WP9ly9f6l+6dEnj////jDA5IJsJxscLYIqANPerV6+efPr06T8IAw29ARRjBckd3rJFcPemTXJ7Nm+WJmQoXPL48ePiFy9ejDx//nzAhQsXkm/evOl15coVNpDcKiDde+wYJwgTdOW2bdvY9+zZI75p0yYRZAvqQ0PZtgBdFrpqFfPDZfNc7y2fXwrEsf+BfJyGnTlzhnXx4sV8q1atYoN6GxROzCBXXAGKAcWF6vf/Z3mxYr7Fy6Vzgt8tn2WL4UKYwNOnTyuAXjpy9erVnY8ePVoDDDNlmDwoEsDskyeFn61duuLG8oVbbi1fuOz1+uXNGC6Eabh9+7YfEKcCDU2/e/du0p07d8Rg8jBLb+zfJPJo3cqkZ6sXx9xes6L4+bqVYSBfoBvItHv3bn5Q2CEnmWPAAAcFAUwMFCG7z5zhr0cyYCYw1o9BIoYJZhjHw4cPtwJddhLoqgvANDflzZs3lUDXnQPyjz168OD0y+/fVf5vXKb9bN2KE4/WLj/2eO3y89+2rKl/v2H5DCD79MN1y88+X7d8+///wBQACnCgYVaHDx92OHr0qBMw/AyBYakBtNUFyLcDJmb7669f8/5fP1/g/oKZjlfn9NvdmDfJ6fPqBdqvVy0wvj5zouO1mb32T+dPtwaFJQA9TWU9Cm/SMwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"\"\n        src=\"/static/f3595faf0b3cc7b07fb76dceb251632e/37523/1.png\"\n        srcset=\"/static/f3595faf0b3cc7b07fb76dceb251632e/e9ff0/1.png 180w,\n/static/f3595faf0b3cc7b07fb76dceb251632e/f21e7/1.png 360w,\n/static/f3595faf0b3cc7b07fb76dceb251632e/37523/1.png 720w,\n/static/f3595faf0b3cc7b07fb76dceb251632e/302a4/1.png 1080w,\n/static/f3595faf0b3cc7b07fb76dceb251632e/07a9c/1.png 1440w,\n/static/f3595faf0b3cc7b07fb76dceb251632e/4dd6f/1.png 5006w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"supervisorscope\" style=\"position:relative;\"><a href=\"#supervisorscope\" aria-label=\"supervisorscope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>supervisorScope</h2>\n<p>예외 전파를 막는 다른 방법은 코루틴 빌더를 <code class=\"language-text\">supervisorScope { ... }</code> 로 래핑하는 것이다.\n다른 코루틴에서 발생한 예외를 무시하고 부모와 연결을 유지할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">fun main(): Unit = runBlocking {\n  supervisorScope {\n    launch {\n      delay(1000)\n      throw Error(\"Some error\")\n    }\n    launch {\n      delay(2000)\n      println(\"Will be printed\")\n    }\n  }\n  delay(1000)\n  println(\"Done\")\n}\n\n// Exception ...\n// Will be printed\n// (1초 후)\n// Done</code></pre></div>\n<p>supervisorScope 는 단지 중단 함수일 뿐이며, 중단 함수 본체를 래핑하는데 사용된다.</p>\n<p>예외 전파를 막는 또다른 방법은 <code class=\"language-text\">coroutineScope { ... }</code> 를 사용하는 것이다.\n이 함수는 부모에 영향을 미치는 대신 try-catch 를 이용해 잡을 수 있는 예외를 던진다.</p>\n<h2 id=\"await\" style=\"position:relative;\"><a href=\"#await\" aria-label=\"await permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>await</h2>\n<p><code class=\"language-text\">async</code> 코루틴 빌더는 launch 처럼 부모 코루틴을 종료하고, 예외를 전파한다.\n<code class=\"language-text\">SupervisorJob</code> or <code class=\"language-text\">supervisorScope</code> 로 전파를 막을수 있는것 또한 동일하다.</p>\n<h2 id=\"cancellation-은-부모까지-전파되지-않는다\" style=\"position:relative;\"><a href=\"#cancellation-%EC%9D%80-%EB%B6%80%EB%AA%A8%EA%B9%8C%EC%A7%80-%EC%A0%84%ED%8C%8C%EB%90%98%EC%A7%80-%EC%95%8A%EB%8A%94%EB%8B%A4\" aria-label=\"cancellation 은 부모까지 전파되지 않는다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cancellation 은 부모까지 전파되지 않는다</h2>\n<p>예외가 CancellationException 의 서브클래스라면 부모로 전파되지 않는다.\n현재 코루틴을 취소하고 예외를 출력할 뿐이다.</p>\n<h2 id=\"코루틴-예외-핸들러\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%98%88%EC%99%B8-%ED%95%B8%EB%93%A4%EB%9F%AC\" aria-label=\"코루틴 예외 핸들러 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴 예외 핸들러</h2>\n<p>예외를 처리하는 기본 행동을 정의하는 것이 유용할 때가 있다.\n이런 경우 <code class=\"language-text\">CoroutineExceptionHandler</code> 컨텍스트를 사용할 수 있다.\n예외 전파를 중단 시키지는 않지만, 예외가 발생했을 때 해야 할 것들을 정의하는데 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Unit <span class=\"token operator\">=</span> runBlocking <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">val</span> handler <span class=\"token operator\">=</span> \n    CoroutineExceptionHandler <span class=\"token punctuation\">{</span> ctx<span class=\"token punctuation\">,</span> exception <span class=\"token operator\">-></span>\n      <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>\"Caught $exception<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">val</span> scope <span class=\"token function\">CoroutineScope</span><span class=\"token punctuation\">(</span><span class=\"token function\">SupervisorJob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> handler<span class=\"token punctuation\">)</span>\n  scope<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token function\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Some error\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  scope<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Will be printed\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Caught java.lang.Error: Some error</span>\n<span class=\"token comment\">// Will be printed</span></code></pre></div>\n<p>안드로이드에서는 사용자에게 대화창이나 에러 메시지를 보여주는 식으로\n어떤 문제가 발생했는지 알리는 역할을 할 수 있다.</p>\n<h1 id=\"코루틴-스코프-함수\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%8A%A4%EC%BD%94%ED%94%84-%ED%95%A8%EC%88%98\" aria-label=\"코루틴 스코프 함수 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴 스코프 함수</h1>\n<p>코루틴 스코프 함수들의 사용법을 알아보는 장이다.</p>\n<h2 id=\"코루틴-스코프-함수가-소개되기-전에-사용한-방법들\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%8A%A4%EC%BD%94%ED%94%84-%ED%95%A8%EC%88%98%EA%B0%80-%EC%86%8C%EA%B0%9C%EB%90%98%EA%B8%B0-%EC%A0%84%EC%97%90-%EC%82%AC%EC%9A%A9%ED%95%9C-%EB%B0%A9%EB%B2%95%EB%93%A4\" aria-label=\"코루틴 스코프 함수가 소개되기 전에 사용한 방법들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴 스코프 함수가 소개되기 전에 사용한 방법들</h2>\n<p>중단 함수에서 중단 함수를 호출하는 것이 첫 번 째 방법이다.\n하지만 이 방법은 순차적으로만 실행된다.\n요청당 1초가 걸리는 중단 함수를 두 번 실행할 경우, 총 2초가 소요된다.</p>\n<p>두 개의 중단 함수를 동시에 실행하려면 <code class=\"language-text\">async</code> 로 각각 래핑해야 한다.\n하지만 <code class=\"language-text\">async</code> 는 스코프가 필요하다.</p>\n<blockquote>\n<p>참고: 이 때 <code class=\"language-text\">GlobalScope</code> 를 사용하는건 좋은 방법이 아니다.</p>\n</blockquote>\n<p><code class=\"language-text\">GlobalScope</code> 는 <code class=\"language-text\">EmptyCoroutineContext</code> 를 가진 스코프일 뿐이다.\n<code class=\"language-text\">GlobalScope</code> 에서 <code class=\"language-text\">async</code> 를 호출하면 부모 코루틴과 아무런 관계가 없다.\n이 때 <code class=\"language-text\">async</code> 코루틴은</p>\n<ul>\n<li>취소할 수 없다. (자원 낭비)</li>\n<li>부모로부터 스코프를 상속받지 않는다. 항상 기본 디스패처에서 실행되며, 부모의 컨텍스트를 전혀 신경쓰지 않는다.</li>\n<li>메모리 누수가 발생할 수 있으며 쓸데 없이 CPU 를 낭비한다.</li>\n<li>코루틴을 유닛 테스트하는 도구가 작동하지 않아 함수를 테스트하기 어렵다.</li>\n</ul>\n<h2 id=\"coroutinescope\" style=\"position:relative;\"><a href=\"#coroutinescope\" aria-label=\"coroutinescope permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>coroutineScope</h2>\n<p>스코프를 시작하는 중단 함수이다. 인자로 들어온 함수가 생성한 값을 반환한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token operator\">&lt;</span>R<span class=\"token operator\">></span> <span class=\"token function\">coroutineScope</span><span class=\"token punctuation\">(</span>\n  block<span class=\"token operator\">:</span> <span class=\"token keyword\">suspend</span> CoroutineScope<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> R\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> R</code></pre></div>\n<p><code class=\"language-text\">coroutineScope</code> 본체는 리시버 없이 곧바로 호출된다.\n<code class=\"language-text\">async</code> 나 <code class=\"language-text\">launch</code>와 다르게 새로운 코루틴을 생성하지만 순차적으로만 실행할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// fun main() = runBlocking { ...</span>\n<span class=\"token keyword\">val</span> a <span class=\"token operator\">=</span> coroutineScope <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token number\">10</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"a is calculated\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">val</span> b <span class=\"token operator\">=</span> coroutineScope <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token number\">20</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">println</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 10</span>\n<span class=\"token function\">println</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 20</span>\n\n<span class=\"token comment\">// (1초 후)</span>\n<span class=\"token comment\">// a is calculated</span>\n<span class=\"token comment\">// (1초 후)</span>\n<span class=\"token comment\">// 10</span>\n<span class=\"token comment\">// 20</span></code></pre></div>\n<h2 id=\"코루틴-스코프-함수-1\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%8A%A4%EC%BD%94%ED%94%84-%ED%95%A8%EC%88%98-1\" aria-label=\"코루틴 스코프 함수 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴 스코프 함수</h2>\n<p>스코프를 만드는 다양한 함수가 있다. <code class=\"language-text\">coroutineScope</code> 와 비슷하게 작동한다.</p>\n<p><code class=\"language-text\">supervisorScope</code>: <code class=\"language-text\">coroutineScope</code>와 비슷하지만, <code class=\"language-text\">Job</code> 대신 <code class=\"language-text\">SupervisorJob</code> 을 사용한다</p>\n<p><code class=\"language-text\">withContext</code>: 코루틴 컨텍스트를 바꿀 수 있는 <code class=\"language-text\">coroutineScope</code></p>\n<p><code class=\"language-text\">withTimeout</code>: 타임아웃이 있는 <code class=\"language-text\">coroutineScope</code></p>\n<p>코루틴 빌더와 코루틴 스코프의 차이를 인지하자.</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>코루틴 빌더 (runBlocking 제외)</th>\n<th>코루틴 스코프 함수</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>예시</td>\n<td>launch, async, produce</td>\n<td>coroutineScope, supervisorScope, withContext, withTimeout</td>\n</tr>\n<tr>\n<td>종류</td>\n<td>CoroutineScope의 확장 함수</td>\n<td>중단 함수</td>\n</tr>\n<tr>\n<td>컨텍스트</td>\n<td>CoroutineScope 리시버의 코루틴 컨텍스트를 사용</td>\n<td>중단 함수와 같은 방식으로 예외를 던짐</td>\n</tr>\n<tr>\n<td>실행 방식</td>\n<td>비동기인 코루틴을 시작함</td>\n<td>코루틴 빌더가 호출된 곳에서 코루틴을 시작함</td>\n</tr>\n</tbody>\n</table>\n<p><code class=\"language-text\">runBlocking</code> 은 블로킹 함수지만 코루틴 스코프 함수는 중단 함수라는 것이다.\n즉 <code class=\"language-text\">runBlocking</code> 은 코루틴 계층에서 가장 상위에 있으며, 코루틴 스코프 함수는 계층 중간에 있는것이다.</p>\n<p>계층으로 표현해보면</p>\n<ul>\n<li>runBlocking &#x3C;- 얘만 최상위 계층 고정\n<ul>\n<li>코루틴 스코프 함수 or 코루틴 빌더</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"withcontext\" style=\"position:relative;\"><a href=\"#withcontext\" aria-label=\"withcontext permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>withContext</h2>\n<p>스코프의 컨텍스트를 변경할 수 있다.\n<code class=\"language-text\">withContext(EmptyContext)</code> 와 <code class=\"language-text\">coroutineScope</code> 는 같은 방식으로 동작한다.</p>\n<p>기존 스코프와 컨텍스트가 다른 스코프를 설정하기 위해 주로 사용된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span>Dispatchers<span class=\"token punctuation\">.</span>Main<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  view<span class=\"token punctuation\">.</span><span class=\"token function\">showProgressBar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">withContext</span><span class=\"token punctuation\">(</span>Dispatchers<span class=\"token punctuation\">.</span>IO<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fileRepository<span class=\"token punctuation\">.</span><span class=\"token function\">saveData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">data</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  view<span class=\"token punctuation\">.</span><span class=\"token function\">hideProgressBar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"supervisorscope-1\" style=\"position:relative;\"><a href=\"#supervisorscope-1\" aria-label=\"supervisorscope 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>supervisorScope</h2>\n<p><code class=\"language-text\">coroutineScope</code> 와의 차이점은 <code class=\"language-text\">Job</code> 을 <code class=\"language-text\">SupervisorJob</code> 으로 오버라이딩 하는것이다.\n서로 독립적이며, 취소 전파가 되서는 안되는 작업을 할 때 사용한다.</p>\n<h2 id=\"withtimeout\" style=\"position:relative;\"><a href=\"#withtimeout\" aria-label=\"withtimeout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>withTimeout</h2>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token function\">withTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">1500</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Still thinking\"</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> \n  <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Done\"</span></span><span class=\"token punctuation\">)</span> \n  <span class=\"token number\">42</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Done 은 출력될 수 없다.</span>\n<span class=\"token comment\">// 1500ms 타임아웃 상태이기 때문이며</span>\n<span class=\"token comment\">// TimeoutCancellationException 을 반환한다.</span></code></pre></div>\n<h2 id=\"코루틴-스코프-함수-연결하기\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%8A%A4%EC%BD%94%ED%94%84-%ED%95%A8%EC%88%98-%EC%97%B0%EA%B2%B0%ED%95%98%EA%B8%B0\" aria-label=\"코루틴 스코프 함수 연결하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코루틴 스코프 함수 연결하기</h2>\n<p>아래 예시처럼 <code class=\"language-text\">withContext</code> 와 <code class=\"language-text\">withTimeoutOrNull</code> 두 개의 코루틴 스코프 함수를 중첩해서 두 가지의 스코프 함수의 기능을 사용할수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">calculateAnswerOrNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> User<span class=\"token operator\">?</span> <span class=\"token operator\">=</span> \n  <span class=\"token function\">withContext</span><span class=\"token punctuation\">(</span>Dispatchers<span class=\"token punctuation\">.</span>Default<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">withTimeoutOrNull</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">calculateAnswer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"추가적인-연산\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EA%B0%80%EC%A0%81%EC%9D%B8-%EC%97%B0%EC%82%B0\" aria-label=\"추가적인 연산 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>추가적인 연산</h2>\n<p>추가적인 연산을 위한 스코프를 만들어서 UseCase 같은 비즈니스 로직 생성자로 주입하는 방법도 있다.\n생성자를 통해 주입하면 유닛테스트를 추가할 수도 있고, 스코프를 사용하는데도 장점이 있다.</p>\n<p>스코프를 전달하면 전달된 클래스를 통해 독립적인 작업을 실행할 수 있다.\n때문에 이 독립적인 작업은 기다릴 필요 없이 종료하면 된다.</p>\n<p>(근데 굳이 이럴 필요가 있을까 싶다. 그냥 “이렇게도 할 수 있다” 는걸 보여주고 싶었던 것 같다.)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqElEQVR42r2Syy8DURTGB30/EAsSgrCoRCxEWNkQia1FN1hIENV2HpogHiFWQhCxUlSIEGlR2umLir1qIwQL/Cno595pOy0bkYhJvpybme/+zplzDqPjAvhLMf8GVHMhqNJScmFJGi74M1DDijAKQej57EstuVjKH6NK8KCCP0K14EYl70YJfwaDEJL9BhIL6TkXuBB5Qf6wD0Vpk54ToWJDaHDso4nbQKOwjRZuHa0jTgL3gLGIUFh9kldt96PA6gctSgaCPPPhZzCDpzAQE81OL3SsxdC7ew/L4SMGDp7QunIN82YC3Vs36HHF0b97C7Mzhr6dBGqmogQuSkmY948kvkNpprLRMEwzUdQR0Vg+HoFp9hK101FY9u9gP3xAlzMOwfOI+rkrKG3+FJDiMtDF8xcwQ2cSVMsGoCAmhTUlWgGN+VYRzRMetE/soW3Mhc7JHVQ4TqFmU72UfjkXunTxKkOp9BlxAXlwWhv5bvOi2H4Co90LHev/2kMJmkzK0NXLV+RZfGTagS8TzCoobYKGrBSVLmedZGAKCrylocukUhVt9C8X+xMldRJz1E6XrgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cover\"\n        title=\"\"\n        src=\"/static/4b408a31e407236aee179777c392489b/37523/cover.png\"\n        srcset=\"/static/4b408a31e407236aee179777c392489b/e9ff0/cover.png 180w,\n/static/4b408a31e407236aee179777c392489b/f21e7/cover.png 360w,\n/static/4b408a31e407236aee179777c392489b/37523/cover.png 720w,\n/static/4b408a31e407236aee179777c392489b/0a867/cover.png 986w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>","frontmatter":{"date":"2026.02.09","title":"코루틴 빌더, 컨텍스트, 잡과 자식 코루틴 기다리기 (Coroutine DEEP DIVE)","categories":"Coroutine","author":"Winter","emoji":null},"fields":{"slug":"/coroutine-deep-dive/3-coroutine-cancel-exception-scope/"}},"site":{"siteMetadata":{"siteUrl":"https://www.winter-love.dev","comments":{"utterances":{"repo":"winter-love-dev/winter-love-dev.github.io"}}}}},"pageContext":{"slug":"/coroutine-deep-dive/2-coroutine-builder-context-job-and-wait-children/","nextSlug":"/coroutine-deep-dive/1-understnad-kotlin-coroutine/","prevSlug":"/coroutine-deep-dive/3-coroutine-cancel-exception-scope/"}},"staticQueryHashes":["1073350324","1321836341","3350743975","339315159","3586530715","988760642"],"slicesMap":{}}